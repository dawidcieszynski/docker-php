#!/bin/bash

typeset script_dir=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )

. "$script_dir/timezone"
. "$script_dir/create-user-from-directory-owner"

# Set timezone in container
_set_timezone "${TIMEZONE}"

# Set DocumentRoot to VOLUME_PATH
sed -i "s|\${VOLUME_PATH}|${VOLUME_PATH}|g" ${APACHE_CONFDIR}/apache2.conf

# Set Apache user/group
create_user_from_directory_owner "${VOLUME_PATH}"

# Set the Apache2 ServerName to the hostname of the container
echo "ServerName `hostname`" > ${APACHE_CONFDIR}/conf-available/set-hostname.conf
a2enconf set-hostname

# Set correct permissions on certificates added to the container
# This has no affect on files hosted through a volume
for FILE in ${CERTIFICATE_PATH}/*; do
    chown root:staff $FILE
    chmod 775 $FILE
done

exec "$@"
